# **The TalonFX Motor Controller**

Before utilizing the TalonFX controller you need to install the vendordep for pheonix6. Once that is complete Ww can start by creating a TalonFX controller on CAN-ID 1:
```java
TalonFX controller = new TalonFX(1);
```

## **Duty Cycle and Voltage Control**
There are a couple types of control we can use with the TalonFX. First we can do simple duty cycle or voltage control.
```java
controller.set(1.0); // 1.0 is the duty cycle were setting the motor controller to use
controller.setVoltage(12.0); // this will set the motor input voltage to use 12 volts
```
!!! note

    More advanced control methods are not always required. For a simple intake or outtake, velocity or position control is not always required.

## **Control Requests**
TalonFX provides very customizable control requests to give programmers control over their mechanisms. The core of the talonfx control requests relies on this method:
```java
controller.setControl(<<<control request>>>);
```

There are a variety of control types you can use:

| Control Request Type      | Description                          |
| ----------- | ------------------------------------ |
| `PositionVoltage`        | This request uses voltage control to reach to a position  |
| `PositionDutyCycle`        | This request uses duty cycle control to reach to a position  |
| `PositionTorqueCurrentFOC`        | This request uses torque FOC control to reach to a position. FOC requires pheonix pro but can also increase motor power output by 15%  |
| `VelocityVoltage`        | This request uses voltage control to reach to a velocity  |
| `VelocityDutyCycle`        | This request uses duty cycle control to reach to a velocity  |
| `VelocityTorqueCurrentFOC`        | This request uses torque FOC control to reach to a velocity. FOC requires pheonix pro but can also increase motor power output by 15%  |

Before you can use any control requests you need to define gains for you motor. This is done through the motor configurator.

!!! note
    To see all the pheonix 6 configurator options and gains here: <a href="https://api.ctr-electronics.com/phoenix6/release/java/com/ctre/phoenix6/configs/TalonFXConfiguration.html">Pheonix 6 Documentation</a>

## **Motion Magic Control**

Motion magic control is pheonix's way of doing trapezoidal motion profiles. When setting your motors configs, you can set motion magic configs to control velocity and acceleration.

## **Gear Ratio**
TalonFX control allows you to set gear ratios for you motor controller.

| Gear Ratio Type      | Description                          |
| ----------- | ------------------------------------ |
| `SensorToMechanism`        | This is the gear ratio between the output of the sensor and the output of the gearbox  |
| `RotorToSensor`        | This is the gear ratio between the rotor and an external sensor  |

## **Code Example**
Here is a code example that shows the configuration of a TalonFX motor controller.

```java
motorController = new TalonFX(1);

TalonFXConfiguration configuration = new TalonFXConfiguration();

configuration.CurrentLimits.StatorCurrentLimit = 40;
configuration.MotorOutput.NeutralMode = NeutralModeValue.Brake;
configuration.MotorOutput.Inverted = InvertedValue.Clockwise_Positive;

configuration.MotionMagic.MotionMagicCruiseVelocity = 25;
configuration.MotionMagic.MotionMagicAcceleration = 60;
configuration.MotionMagic.MotionMagicJerk = 300;

configuration.Slot0.GravityType = GravityTypeValue.Elevator_Static;
configuration.Slot0.kP = 3.0;
configuration.Slot0.kI = 0.02;
configuration.Slot0.kD = 0.0;
configuration.Slot0.kV = 3.4;
configuration.Slot0.kA = 1.5;
configuration.Slot0.kS = 0.25;
configuration.Slot0.kG = 0.6;

configuration.Feedback.SensorToMechanismRatio = 8.14;

motorController.getConfigurator().apply(configuration);
```

!!! note
    Note that not all these parameters have to be set depending on the usecase. For example, if you only want to do pid you dont have to set the feed forward gains.